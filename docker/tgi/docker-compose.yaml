# docker/tgi/docker-compose.yaml
version: '3.8'

services:
  tgi:
    build: .
    ports:
      - "${PORT:-8003}:80"
    environment:
      - CUDA_VISIBLE_DEVICES=${CUDA_DEVICE:-0}
      - MODEL_ID=${MODEL_ID:-Qwen/Qwen3-VL-4B-Instruct}
      - DTYPE=${DTYPE:-bfloat16}
      - MAX_TOTAL_TOKENS=${MAX_TOTAL_TOKENS:-4096}
      - MAX_INPUT_LENGTH=${MAX_INPUT_LENGTH:-2048}
      - CUDA_MEMORY_FRACTION=${CUDA_MEMORY_FRACTION:-0.85}
    volumes:
      - ~/.cache/huggingface:/data
    shm_size: '8gb'
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              device_ids: ['${CUDA_DEVICE:-0}']
              capabilities: [gpu]
